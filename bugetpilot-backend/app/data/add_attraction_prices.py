# -*- coding: utf-8 -*-
"""전국관광지정보표준데이터.csv에 입장료(가격) 컬럼 추가. 유료 관광지만 대략적인 금액 설정."""
import re
import pandas as pd

INPUT_CSV = "전국관광지정보표준데이터.csv"
OUTPUT_CSV = "전국관광지정보표준데이터.csv"

# 관광지명 또는 소개에 포함되면 해당 가격 적용 (먼저 매칭된 규칙 적용)
# (키워드 패턴, 가격 원)
PRICE_RULES = [
    # 케이블카
    (r"케이블카|케이블 카", 12000),
    # 테마파크 / 대형 유료
    (r"롯데월드", 45000),
    (r"오월드|오-월드", 25000),
    (r"레고랜드", 50000),
    (r"경주월드", 45000),
    (r"테마파크|테마 파크", 35000),
    (r"렛츠런파크", 5000),
    # 아쿠아리움 / 수족관
    (r"아쿠아리움|아쿠아 플라넷|아쿠아플라넷", 25000),
    (r"수족관|해저.*테마", 20000),
    # 궁궐 / 성
    (r"경복궁", 3000),
    (r"창덕궁", 3000),
    (r"화성행궁|수원화성", 1000),
    (r"남한산성", 2000),
    # 박물관 / 기념관 / 역사관 (일반)
    (r"박물관", 4000),
    (r"기념관", 3000),
    (r"역사관|역사 관", 2000),
    (r"과학관|과학 공원|엑스포과학", 4000),
    (r"미술관", 5000),
    # 리조트(입장/이용료)
    (r"설악한화리조트", 35000),
    (r"예술랜드리조트", 25000),
    (r"천안종합휴양|워터파크", 40000),
    # 온천/스파
    (r"척산온천", 15000),
    (r"허심청", 15000),
    (r"유성온천", 12000),
    # 동굴
    (r"동굴", 6000),
    # 루지 / 레포츠
    (r"루지", 15000),
    # 공원/휴양림(매표소)
    (r"절물자연휴양림", 1000),
    (r"마니산 국민관광지", 2000),
    (r"춘천호반\(삼악산\)|삼악산", 2500),
    (r"구곡폭포", 2000),
    (r"송도용궁구름다리|용궁구름다리", 1000),
    (r"제주별빛누리공원|별빛누리", 5000),
    (r"노루생태관찰원", 3000),
    (r"장사도해상공원", 8000),
    (r"뿌리공원", 5000),
    (r"인천나비공원", 5000),
    # 기타 유료
    (r"화원관광지", 10000),
    (r"금정산\b", 0),  # 케이블카는 별도
    (r"금정산.*케이블|케이블.*금정산", 9000),
    (r"삼학도크루즈|유람선", 12000),
    (r"연희네슈퍼", 5000),
    (r"부산영화체험박물관", 10000),
    (r"전주동물원|전주드림랜드", 10000),
    (r"가위박물관", 5000),
    (r"감귤박물관", 5000),
    (r"부평안전체험관", 3000),
    (r"기후변화체험관", 2000),
    (r"사라온 이야기 마을", 5000),
]

def get_price(name, intro):
    """관광지명과 소개를 보고 유료면 입장료(원), 무료면 0."""
    if not name:
        return 0
    text = (str(name) + " " + str(intro or ""))[:500]
    for pattern, price in PRICE_RULES:
        if re.search(pattern, text, re.IGNORECASE):
            return price
    return 0

def main():
    for enc in ("utf-8-sig", "utf-8", "cp949"):
        try:
            df = pd.read_csv(INPUT_CSV, encoding=enc, low_memory=False)
            break
        except Exception:
            continue
    else:
        raise SystemExit("CSV 인코딩을 읽을 수 없습니다.")

    df.columns = df.columns.astype(str).str.strip()
    if "가격" in df.columns:
        df = df.drop(columns=["가격"])
    df["가격"] = df.apply(
        lambda r: get_price(r.get("관광지명"), r.get("관광지소개")),
        axis=1,
    )
    df.to_csv(OUTPUT_CSV, index=False, encoding="utf-8-sig")
    paid = (df["가격"] > 0).sum()
    print(f"가격 컬럼 추가 완료. 유료 관광지: {paid}개 / 전체: {len(df)}개")

if __name__ == "__main__":
    main()
